<!-- src/app/pages/dashboard/dashboard.html -->
<div *ngIf="isLoading" class="loading-container">
  <div class="spinner"></div>
  <p>Cargando proyecto...</p>
</div>

<div *ngIf="!isLoading && proyecto">
  <div class="project-header">
    <div class="project-title">
      <span class="project-icon">游닍</span>
      <h2>{{ proyecto.nombre }}</h2>
    </div>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="verTablero()">Ver Tablero</button>
      <button class="btn btn-secondary" (click)="eliminarProyecto()">Eliminar proyecto</button>
    </div>
  </div>

  <div class="stats-cards">
    <div class="stat-card">
      Finalizadas 
      <span>{{ stats.finalizadas }}</span>
    </div>
    <div class="stat-card">
      Creadas 
      <span>{{ stats.creadas }}</span>
    </div>
    <div class="stat-card">
      Vencen pronto 
      <span>{{ stats.vencenProximas }}</span>
    </div>
  </div>

  <div class="widgets-grid">
    
    <!-- Widget 1: Resumen del estado -->
    <div class="widget">
      <h3>Resumen del estado</h3>
      <p>Obt칠n una instant치nea del estado de tus actividades</p>
      <div class="donut-chart-container">
        <div class="chart-wrapper">
          <canvas 
            baseChart
            [data]="donutChartData"
            [options]="donutChartOptions"
            type="doughnut">
          </canvas>
        </div>
        <div class="chart-legend">
          <div class="legend-item">
            <span class="legend-color" style="background-color: #5b8f97;"></span>
            <label>Por hacer: {{ donutChartData.datasets[0].data[0] }}</label>
          </div>
          <div class="legend-item">
            <span class="legend-color" style="background-color: #a8d5dc;"></span>
            <label>En curso: {{ donutChartData.datasets[0].data[1] }}</label>
          </div>
          <div class="legend-item">
            <span class="legend-color" style="background-color: #d1eaee;"></span>
            <label>Listo: {{ donutChartData.datasets[0].data[2] }}</label>
          </div>
        </div>
      </div>
    </div>

    <!-- Widget 2: Actividad reciente -->
    <div class="widget">
      <h3>Actividad reciente</h3>
      <p>Mantente al d칤a de lo que sucede en todo el proyecto</p>
      <ul class="activity-feed">
        <li class="feed-item" *ngFor="let notificacion of notificaciones">
          <span class="user-icon">游댒</span>
          <div class="feed-text">
            <strong>{{ notificacion.mensaje }}</strong>
            <span class="feed-time">{{ formatearFecha(notificacion.creado_en) }}</span>
          </div>
        </li>
        <li class="feed-item" *ngIf="notificaciones.length === 0">
          <span class="user-icon">游닔</span>
          <div class="feed-text">
            <em>No hay actividad reciente</em>
          </div>
        </li>
      </ul>
    </div>

    <!-- Widget 3: Distribuci칩n de tareas -->
    <div class="widget">
      <h3>Distribuci칩n de tareas</h3>
      <p>Visualiza la distribuci칩n de tu trabajo</p>
      <div class="bar-chart-placeholder">
        <div class="bar-wrapper">
          <div class="bar" [style.height.%]="(donutChartData.datasets[0].data[0] / stats.creadas * 100) || 0"></div>
          <span>Por hacer</span>
        </div>
        <div class="bar-wrapper">
          <div class="bar" [style.height.%]="(donutChartData.datasets[0].data[1] / stats.creadas * 100) || 0"></div>
          <span>En curso</span>
        </div>
        <div class="bar-wrapper">
          <div class="bar" [style.height.%]="(donutChartData.datasets[0].data[2] / stats.creadas * 100) || 0"></div>
          <span>Listo</span>
        </div>
      </div>
    </div>

    <!-- Widget 4: Tareas recientes -->
    <div class="widget">
      <h3>Tareas recientes</h3>
      <p>Las 칰ltimas tareas del proyecto</p>
      <ul class="task-list">
        <li *ngFor="let tarea of tareas.slice(0, 5)" class="task-item">
          <div class="task-info">
            <h4>{{ tarea.titulo }}</h4>
            <p *ngIf="tarea.descripcion">{{ tarea.descripcion }}</p>
          </div>
          <span class="task-status" [ngClass]="'status-' + tarea.estado.toLowerCase()">
            {{ tarea.estado }}
          </span>
        </li>
        <li *ngIf="tareas.length === 0" class="task-item empty">
          <em>No hay tareas en este proyecto</em>
        </li>
      </ul>
    </div>

  </div>
</div>

<div *ngIf="!isLoading && !proyecto" class="error-container">
  <h2>Proyecto no encontrado</h2>
  <button class="btn btn-primary" routerLink="/recomendados">Volver a proyectos</button>
</div>